# Генератор документов "Извещение на замену материалов"

Приложение для автоматизации создания документов "Извещение на замену материалов" на основе Excel-шаблона.

## Возможности

- Автоматическое заполнение шаблона Excel на основе введённых данных
- Автоподстановка материалов, единиц измерения и норм из справочника
- История замен материалов с предложениями при вводе
- Автоматическая нумерация документов с обнулением по году
- Автоматическое заполнение блока "Вручено" на основе цехов в документе
- Поддержка дополнительных листов при большом объёме данных

## Установка

1. Установите Python 3.8 или выше
2. Создайте виртуальное окружение:
```bash
python3 -m venv venv
source venv/bin/activate
```
3. Установите системные зависимости Qt (требуется sudo):
```bash
sudo apt-get update
sudo apt-get install -y libxcb-cursor0 libxcb-xinerama0 libxcb-xfixes0 \
    libxcb-render-util0 libxcb-icccm4 libxcb-image0 libxcb-keysyms1 \
    libxcb-randr0 libxcb-render0 libxcb-shape0 libxcb-sync1 libxcb-xkb1 \
    libxkbcommon-x11-0
```
Или используйте скрипт:
```bash
./install_dependencies.sh
```
4. Установите Python зависимости:
```bash
pip install -r requirements.txt
```

## Структура проекта

```
OMTS/
├── app/                    # Код приложения
│   ├── gui/               # GUI компоненты
│   ├── catalog_loader.py  # Загрузчик справочника
│   ├── history_store.py   # Хранилище истории замен
│   ├── excel_generator.py # Генератор Excel документов
│   └── ...
├── catalog/               # Справочник деталей и материалов
│   └── catalog.xlsx      # Файл справочника
├── templates/            # Шаблоны Excel
│   └── Izveshchenie_template.xlsx
├── data/                 # Данные приложения
│   ├── numbering.json    # Счётчик номеров документов
│   ├── history.json     # История замен
│   └── template_config.json  # Конфигурация шаблона
├── output/              # Сгенерированные документы
└── main.py              # Точка входа
```

## Запуск

Активируйте виртуальное окружение и запустите:
```bash
source venv/bin/activate
python main.py
```

Или используйте скрипт запуска:
```bash
./run.sh
```

## Использование

### 1. Подготовка справочника

Справочник находится в файле `catalog/catalog.xlsx`. Структура:

| Колонка | Описание | Пример |
|---------|----------|--------|
| Деталь (Part) | Код детали | КИР 03.614 |
| Цех (Workshop) | Цех | ПЗУ, ЗМУ, СУ, ОСУ |
| Тип позиции (Role) | Тип материала | краска, разбавитель, отвердитель |
| Наименование материала 'до' | Название материала | Грунт-эмаль PentriProtect PUR 700... |
| Ед. изм. (Unit) | Единица измерения | кг |
| Норма (Norm) | Норма расхода | 0.0530 |
| Примечание | Дополнительная информация | |

### 2. Создание документа

1. Запустите приложение
2. На вкладке "Реквизиты документа" заполните:
   - Дата внедрения замены
   - Срок действия (партия)
   - Изделие
   - Причина
   - Заключение ТКО
3. На вкладке "Изменения материалов":
   - Выберите деталь из списка или введите вручную
   - Нажмите "Добавить"
   - Для каждой строки материала:
     - Отметьте чекбокс "Меняем", если материал заменяется
     - Введите или выберите материал "после" (программа предложит варианты из истории)
4. Нажмите "Сгенерировать документ"
5. Выберите место сохранения

### 3. Нумерация документов

Номер документа генерируется автоматически:
- Счётчик увеличивается с каждым новым документом
- При смене года счётчик обнуляется
- Номер хранится в `data/numbering.json`

### 4. История замен

При вводе материала "после" программа:
- Сохраняет вариант в историю
- При следующем вводе для той же детали/цеха/типа позиции предлагает сохранённые варианты

## Формат справочника

Справочник должен быть в формате Excel (.xlsx) со следующими колонками:

1. **Деталь (Part)** - код детали
2. **Цех (Workshop)** - ПЗУ, ЗМУ, СУ, ОСУ
3. **Тип позиции (Role)** - краска, разбавитель, отвердитель, лист, круг и т.д.
4. **Наименование материала 'до' (BeforeName)** - полное название
5. **Ед. изм. (Unit)** - кг, шт, м и т.д.
6. **Норма (Norm)** - числовое значение
7. **Примечание (Comment)** - опционально

## Особенности

- **Цеха**: Каждая строка материала привязана к цеху. В блоке "Вручено" автоматически отмечаются все цеха, встречающиеся в документе.
- **Детали**: Для одной детали может быть несколько строк материалов (краска, разбавитель, отвердитель и т.д.)
- **Дополнительные листы**: Если данных больше, чем помещается на первом листе, они автоматически переносятся на дополнительные листы.

## Требования

- Python 3.8+
- PySide6
- openpyxl
- xlrd

## Лицензия

Внутреннее использование

